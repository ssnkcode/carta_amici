console.log("üó∫Ô∏è map-core.js cargado");const MAP_CONFIG={businessLocation:{lat:-31.342722,lng:-64.474847,address:"V. Roque S√°enz Pe√±a, Bialet Masse, C√≥rdoba, Argentina"},osrmServer:"https://router.project-osrm.org",nominatimServer:"https://nominatim.openstreetmap.org",costoPorMinuto:500,validationMode:"flexible",defaultDistanceIfNotFound:15,allowedCities:["villa carlos paz","san antonio de arredondo","mayu sumaj","icho cruz","cuesta blanca","tanti","cabalango","estancia vieja","villa santa cruz del lago","siquiman","bialet masse","santa mar√≠a","santa maria de punilla","cosqu√≠n","cosquin","molinari","casa grande","valle hermoso","la falda","huerta grande","villa giardino","la cumbre","los cocos","san esteban","capilla del monte","charbonier","cruz del eje","de√°n funes"],cache:new Map,cacheDuration:18e5};function cleanAddressForSearch(a){return a?a.replace(/\b(barrio|b¬∞|b\.|bo\.)\s+/gi,"").replace(/\b(manzana|mz|mza)\s+\w+/gi,"").replace(/\b(lote|lt)\s+\w+/gi,"").replace(/\b(casa)\s+\w+/gi,"").replace(/\s+/g," ").trim():""}function setupStaticMap(){const a=document.getElementById("map-frame");if(!a)return;const e=MAP_CONFIG.businessLocation.lat,t=MAP_CONFIG.businessLocation.lng,n=`https://www.openstreetmap.org/export/embed.html?bbox=${t-.05},${e-.05},${t+.05},${e+.05}&layer=mapnik&marker=${e},${t}&zoom=13`;a.innerHTML=`\n        <iframe \n            src="${n}"\n            width="100%" \n            height="100%" \n            style="border:none; border-radius: 8px;"\n            allowfullscreen\n            loading="lazy"\n            referrerpolicy="no-referrer-when-downgrade"\n            title="Ubicaci√≥n Comidas AMICI">\n        </iframe>\n    `}async function geocodeAddress(a){const e=`geocode:${a}`;if(MAP_CONFIG.cache.has(e))return MAP_CONFIG.cache.get(e);try{const t=a.split(",")[0]||"",n=extractCityFromAddress(a)||"",o=cleanAddressForSearch(t),r=[];if(o&&n&&r.push({q:`${o}, ${n}, C√≥rdoba, Argentina`,tipo:"exacta"}),o&&n&&/\d+/.test(o)){const a=o.replace(/\d+/g,"").trim();r.push({q:`${a}, ${n}, C√≥rdoba, Argentina`,tipo:"calle_aproximada"})}n&&r.push({q:`${n}, C√≥rdoba, Argentina`,tipo:"ciudad"});for(const a of r){const t=`${MAP_CONFIG.nominatimServer}/search?q=${encodeURIComponent(a.q)}&format=json&limit=1&addressdetails=1`,n=await fetch(t,{headers:{"User-Agent":"ComidasAMICI-Delivery/1.0"}});if(n.ok){const t=await n.json();if(t&&t.length>0){const n=parseGeocodingResult(t[0]);return"exacta"!==a.tipo&&(n.esAproximado=!0,n.mensajeNota="ciudad"===a.tipo?"Direcci√≥n no encontrada. Calculando al centro de la ciudad.":"Altura no encontrada. Calculando a la calle."),MAP_CONFIG.cache.set(e,n),n}}}const l=extractCityFromAddress(a)||"Santa Mar√≠a",i=getDefaultCoordinatesForCity(l);if(i){const t={lat:i.lat,lng:i.lng,direccion:a,direccionCorta:l,barrio:l,ciudad:l,tipoLugar:"city",esAproximado:!0,esPorDefecto:!0,mensajeNota:"Ubicaci√≥n no encontrada en mapa. Usando referencia de ciudad."};return MAP_CONFIG.cache.set(e,t),t}return null}catch(a){return console.error(a),null}}function parseGeocodingResult(a){return{lat:parseFloat(a.lat),lng:parseFloat(a.lon),direccion:a.display_name,direccionCorta:`${a.address.road||""} ${a.address.house_number||""}`.trim(),barrio:a.address.suburb||a.address.neighbourhood||a.address.village||"",ciudad:a.address.city||a.address.town||a.address.municipality||a.address.county||"C√≥rdoba",tipoLugar:a.type}}function getDefaultCoordinatesForCity(a){const e={"villa carlos paz":{lat:-31.4208,lng:-64.4992},"san antonio de arredondo":{lat:-31.4806,lng:-64.5222},"mayu sumaj":{lat:-31.495,lng:-64.5317},"icho cruz":{lat:-31.4889,lng:-64.5494},"cuesta blanca":{lat:-31.4933,lng:-64.5686},tanti:{lat:-31.3533,lng:-64.5906},cabalango:{lat:-31.3917,lng:-64.5611},"estancia vieja":{lat:-31.3789,lng:-64.5233},"villa santa cruz del lago":{lat:-31.3856,lng:-64.5097},siquiman:{lat:-31.3667,lng:-64.4833},"villa parque siquiman":{lat:-31.3667,lng:-64.4833},"bialet masse":{lat:-31.3427,lng:-64.4748},"santa mar√≠a":{lat:-31.3,lng:-64.4667},"santa mar√≠a de punilla":{lat:-31.3,lng:-64.4667},cosqu√≠n:{lat:-31.2417,lng:-64.4706},molinari:{lat:-31.205,lng:-64.475},"casa grande":{lat:-31.1833,lng:-64.4783},"valle hermoso":{lat:-31.1167,lng:-64.4833},"la falda":{lat:-31.0833,lng:-64.4833},"huerta grande":{lat:-31.05,lng:-64.4917},"villa giardino":{lat:-31.0333,lng:-64.495},"la cumbre":{lat:-30.9833,lng:-64.4917},"los cocos":{lat:-30.925,lng:-64.5},"san esteban":{lat:-30.9167,lng:-64.5333},"capilla del monte":{lat:-30.85,lng:-64.5333},charbonier:{lat:-30.7667,lng:-64.55},"cruz del eje":{lat:-30.7167,lng:-64.8},"de√°n funes":{lat:-30.4333,lng:-64.35},c√≥rdoba:{lat:-31.4201,lng:-64.1888}},t=a.toLowerCase();for(const a in e)if(t.includes(a)||a.includes(t))return e[a];return null}async function calculateRoute(a,e){const t=`route:${a.lat},${a.lng}-${e.lat},${e.lng}`;if(MAP_CONFIG.cache.has(t))return MAP_CONFIG.cache.get(t);if(e.esPorDefecto)return calculateEstimatedDistance(a,e);try{const n=`${MAP_CONFIG.osrmServer}/route/v1/driving/${a.lng},${a.lat};${e.lng},${e.lat}?overview=simplified&alternatives=false&steps=true`,o=await fetch(n);if(!o.ok)throw new Error(`OSRM error: ${o.status}`);const r=await o.json();if("Ok"===r.code&&r.routes&&r.routes.length>0){const a=r.routes[0],e={distancia:a.distance,duracion:a.duration,distanciaKm:(a.distance/1e3).toFixed(2),duracionMinutos:Math.ceil(a.duration/60),esExacto:!0,geometria:a.geometry};return MAP_CONFIG.cache.set(t,e),e}return calculateEstimatedDistance(a,e)}catch(t){return calculateEstimatedDistance(a,e)}}function calculateEstimatedDistance(a,e){const t=a.lat*Math.PI/180,n=e.lat*Math.PI/180,o=(e.lat-a.lat)*Math.PI/180,r=(e.lng-a.lng)*Math.PI/180,l=Math.sin(o/2)*Math.sin(o/2)+Math.cos(t)*Math.cos(n)*Math.sin(r/2)*Math.sin(r/2),i=1.4*(6371e3*(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)))),s=i/11.11;return{distancia:Math.round(i),duracion:Math.round(s),distanciaKm:(i/1e3).toFixed(2),duracionMinutos:Math.ceil(s/60),esExacto:!1,esEstimado:!0}}function generarUrlUbicacion(){const a=document.getElementById("customer-street")?.value.trim()||"",e=document.getElementById("customer-number")?.value.trim()||"",t=document.getElementById("customer-neighborhood")?.value.trim()||"",n=document.getElementById("customer-city")?.value.trim()||"";if(!a||!e||!n)return null;let o=`${a}+${e}`;t&&(o+=`,+${t}`),o+=`,+${n},+C√≥rdoba,+Argentina`,o=o.replace(/\s+/g,"+").replace(/√±/g,"n").replace(/√ë/g,"N").replace(/[√°√©√≠√≥√∫√Å√â√ç√ì√ö]/g,(a=>"aeiouAEIOU"["√°√©√≠√≥√∫√Å√â√ç√ì√ö".indexOf(a)]));return{googleMaps:`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(o)}`,direccionTexto:`${a} ${e}${t?", "+t:""}, ${n}, C√≥rdoba, Argentina`.replace(/, ,/g,",").replace(/^\s*,\s*|\s*,\s*$/g,""),direccionCorta:`${a} ${e}, ${n}`}}window.MAP_CONFIG=MAP_CONFIG,window.setupStaticMap=setupStaticMap,window.geocodeAddress=geocodeAddress,window.parseGeocodingResult=parseGeocodingResult,window.getDefaultCoordinatesForCity=getDefaultCoordinatesForCity,window.calculateRoute=calculateRoute,window.calculateEstimatedDistance=calculateEstimatedDistance,window.generarUrlUbicacion=generarUrlUbicacion,window.cleanAddressForSearch=cleanAddressForSearch;